<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montador de Propostas - Draence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page-wrapper">
        <header>
            <div class="logo-section">
                <img src="Pes_drae.png" alt="Draence Logo">
                <div class="logo-text">
                    <h1>DRAENCE</h1>
                    <p>Montador de Propostas</p>
                </div>
            </div>
            <div class="header-spacer"></div>
            <a href="index.html" class="status-badge" style="cursor: pointer; text-decoration: none;">‚Üê Voltar</a>
        </header>

        <div class="container">
            <div class="proposal-layout">
                <div class="proposal-form">
                    
                    <div class="card" id="card-negociacao">
                        <div class="card-title">
                            Dados da Negocia√ß√£o 
                            <span class="card-status" id="status-negociacao"></span>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tipoNegociacao">Tipo de Negocia√ß√£o *</label>
                                <select id="tipoNegociacao">
                                    <option value="">-- Selecione --</option>
                                    <option value="Compra">Compra Definitiva</option>
                                    <option value="Empr√©stimo">Empr√©stimo</option>
                                    <option value="Renova√ß√£o">Renova√ß√£o</option>
                                    <option value="Livre">Contrato Livre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="nomeJogador">Nome do Jogador *</label>
                                <input type="text" id="nomeJogador" placeholder="Ex: Haaland">
                            </div>
                            <div class="form-group">
                                <label for="timeAtual">Clube Atual</label>
                                <input type="text" id="timeAtual" placeholder="Ex: Manchester City">
                            </div>
                            <div class="form-group">
                                <label for="anosContrato">Dura√ß√£o (Temporadas) *</label>
                                <input type="number" id="anosContrato" min="1" max="10" placeholder="3">
                            </div>
                        </div>
                    </div>

                    <div class="card" id="card-financeiro">
                        <div class="card-title">
                            Termos Financeiros
                            <span class="card-status" id="status-financeiro"></span>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="valorCompra">üí≤ Valor de Compra / Passe *</label>
                                <div class="input-wrapper">
                                    <input type="text" id="valorCompra" class="input-money" placeholder="¬£D 0,00">
                                    <span class="magnitude-badge"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="formaPagamento">üí≥ Forma de Pagamento</label>
                                <input type="text" id="formaPagamento" placeholder="Ex: √Ä vista">
                            </div>
                            <div class="form-group">
                                <label for="luvasOferecidas">üí∞ Luvas (Assinatura)*</label>
                                <div class="input-wrapper">
                                    <input type="text" id="luvasOferecidas" class="input-money" placeholder="¬£D 0,00" data-min="0" data-max="999999999">
                                    <span class="magnitude-badge"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="salarioOferecido">üíµ Sal√°rio Mensal*</label>
                                <div class="input-wrapper">
                                    <input type="text" id="salarioOferecido" class="input-money" placeholder="¬£D 0,00" data-min="0" data-max="999999999">
                                    <span class="magnitude-badge"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="card-multas">
                        <div class="card-title">
                            Multas e Cl√°usulas
                            <span class="card-status" id="status-multas"></span>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="multaDraence">üö´ Multa de Sa√≠da (Draence)</label>
                                <div class="input-wrapper input-readonly">
                                    <input type="text" id="multaDraence" class="input-money" placeholder="¬£D 0,00">
                                    <span class="magnitude-badge"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="multaExterior">üö´ Multa Exterior (‚Ç¨)</label>
                                <div class="input-wrapper input-readonly">
                                    <input type="text" id="multaExterior" class="input-money" placeholder="‚Ç¨ 0,00">
                                    <span class="magnitude-badge"></span>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label for="inputPremiacao">Premia√ß√µes / B√¥nus</label>
                                <div class="dynamic-input-group">
                                    <input type="text" id="inputPremiacao" placeholder="Ex: 1M se for artilheiro" onkeypress="handleEnter(event, 'addPremiacao')">
                                    <button type="button" class="btn-add-item" onclick="adicionarPremiacao()">+</button>
                                </div>
                                <div id="listaPremiacoes" class="dynamic-list-container"></div>
                            </div>

                            <div class="form-group full-width">
                                <label for="inputClausula">Cl√°usulas Extras</label>
                                <div class="dynamic-input-group">
                                    <input type="text" id="inputClausula" placeholder="Ex: Multa de 50M para rivais" onkeypress="handleEnter(event, 'addClausula')">
                                    <button type="button" class="btn-add-item" onclick="adicionarClausula()">+</button>
                                </div>
                                <div id="listaClausulas" class="dynamic-list-container"></div>
                            </div>
                        </div>
                    </div>

                </div> 

                <div class="proposal-preview-sidebar">
                    <div style="margin-bottom: 10px; font-weight: 600; color: var(--text-secondary);">
                        üì± Pr√©via da Mensagem
                    </div>
                    
                    <div class="preview-box" id="textoPreview">
                    </div>

                    <div class="action-bar">
                        <button id="btnCopiar" class="btn-primary full-width-btn">
                            üì≤ Copiar Proposta
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <p style="color: var(--text-secondary); margin: 0; font-size: 0.9em;">
            Desenvolvido por <a href="https://github.com/J0NGS" target="_blank" style="color: var(--accent-primary); text-decoration: none; font-weight: 500;">J0NGS</a><br>
            Draence Calculator v4.0.0 ‚Ä¢ Todos os direitos reservados ¬© 2026
        </p>
    </footer>

    <script src="script.js"></script>
    <script>
        // ============================================
        // MONTADOR DE PROPOSTAS
        // ============================================

        // Estado das listas din√¢micas
        let premiacoesList = [];
        let clausulasList = [];

        function lerParametrosURL() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.has('salario')) {
                document.getElementById('salarioOferecido').value = params.get('salario');
            }
            if (params.has('luvas')) {
                document.getElementById('luvasOferecidas').value = params.get('luvas');
            }
            if (params.has('anos')) {
                document.getElementById('anosContrato').value = params.get('anos');
            }
            if (params.has('multa')) {
                document.getElementById('multaDraence').value = params.get('multa');
            }
            if (params.has('multaExterior')) {
                document.getElementById('multaExterior').value = params.get('multaExterior');
            }
        }

        function gerarTextoProposta() {
            const tipo = document.getElementById('tipoNegociacao').value || '---';
            const nome = document.getElementById('nomeJogador').value || '---';
            const anos = document.getElementById('anosContrato').value || '---';
            const valorCompra = parseMoney(document.getElementById('valorCompra').value) || 0;
            const formaPagamento = document.getElementById('formaPagamento').value || '√Ä definir';
            const luvas = parseMoney(document.getElementById('luvasOferecidas').value) || 0;
            const salario = parseMoney(document.getElementById('salarioOferecido').value) || 0;
            const multaDraence = parseMoney(document.getElementById('multaDraence').value) || 0;
            const multaExterior = parseMoney(document.getElementById('multaExterior').value) || 0;
            
            // Formatar arrays de listas din√¢micas com bullets
            const textoPremiacoes = premiacoesList.length > 0 
                ? premiacoesList.map(item => `‚Ä¢ ${item}`).join('\n')
                : '---';
            const textoClausulas = clausulasList.length > 0 
                ? clausulasList.map(item => `‚Ä¢ ${item}`).join('\n')
                : '---';

            // Fun√ß√£o de formata√ß√£o para ¬£D (Draence)
            const formatValueDraence = (val) => {
                if (!val || isNaN(val) || val === 0) return '---';
                const numero = Math.floor(val);
                const formatado = numero.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                return '¬£D ' + formatado;
            };

            // Fun√ß√£o de formata√ß√£o para ‚Ç¨ (Euro - Exterior)
            const formatValueEuro = (val) => {
                if (!val || isNaN(val) || val === 0) return '---';
                const numero = Math.floor(val);
                const formatado = numero.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                return '‚Ç¨ ' + formatado;
            };

            const texto = `*üíº TIPO DE NEGOCIA√á√ÉO*
${tipo}

*‚öΩ JOGADOR*
${nome} | ${document.getElementById('timeAtual').value || '---'}

*üóìÔ∏è DURA√á√ÉO*
${anos} temporada(s)

*üí∞ VALOR*
${formatValueDraence(valorCompra)}

*üíµ LUVAS*
${formatValueDraence(luvas)}

*üí∏ SAL√ÅRIO MENSAL*
${formatValueDraence(salario)}

*üìù PAGAMENTO*
${formaPagamento}

*üö´ MULTA DRAENCE*
${formatValueDraence(multaDraence)}

*üåç MULTA EXTERIOR*
${formatValueEuro(multaExterior)}

*üèÜ PREMIA√á√ïES*
${textoPremiacoes}

*üìã CL√ÅUSULAS*
${textoClausulas}`;

            return texto;
        }

        function atualizarProposta() {
            const texto = gerarTextoProposta();
            document.getElementById('textoPreview').textContent = texto;
            atualizarStatusCards();
        }

        function atualizarStatusCards() {
            const cards = [
                { id: 'card-negociacao', fields: ['tipoNegociacao', 'nomeJogador', 'anosContrato'], statusId: 'status-negociacao' },
                { id: 'card-financeiro', fields: ['valorCompra', 'luvasOferecidas', 'salarioOferecido'], statusId: 'status-financeiro' },
                { id: 'card-multas', fields: ['multaDraence'], statusId: 'status-multas' }
            ];

            let allCardsOk = true;

            cards.forEach(cardData => {
                let cardOk = true;
                cardData.fields.forEach(fieldId => {
                    const el = document.getElementById(fieldId);
                    if (!el || !el.value || !el.value.trim()) {
                        cardOk = false;
                    }
                });

                const statusEl = document.getElementById(cardData.statusId);
                if (statusEl) {
                    if (cardOk) {
                        statusEl.classList.add('ok');
                    } else {
                        statusEl.classList.remove('ok');
                        allCardsOk = false;
                    }
                }
            });

            // Ativar step 4 se todos os cards est√£o OK
            const steps = document.querySelectorAll('.step-item');
            if (allCardsOk && steps.length > 3) {
                steps[3].classList.add('active');
            } else if (steps.length > 3) {
                steps[3].classList.remove('active');
            }
        }

        /**
         * Verifica se h√° texto pendente nos inputs de listas din√¢micas
         */
        function verificarInputsPendentes() {
            const pendentePremio = document.getElementById('inputPremiacao').value.trim();
            const pendenteClausula = document.getElementById('inputClausula').value.trim();
            
            if (pendentePremio || pendenteClausula) {
                const items = [];
                if (pendentePremio) items.push(`‚Ä¢ Premia√ß√£o: "${pendentePremio}"`);
                if (pendenteClausula) items.push(`‚Ä¢ Cl√°usula: "${pendenteClausula}"`);
                
                alert('‚ö†Ô∏è ATEN√á√ÉO: Voc√™ digitou item(ns) mas n√£o adicionou √† lista:\n\n' + items.join('\n') + '\n\nClique "+" ou pressione Enter para adicionar antes de copiar!');
                return false;
            }
            return true;
        }

        function copiarProposta() {
            if (!verificarInputsPendentes()) return;
            
            const texto = gerarTextoProposta();
            const btnCopiar = document.getElementById('btnCopiar');
            
            navigator.clipboard.writeText(texto).then(() => {
                const textoOriginal = btnCopiar.textContent;
                btnCopiar.textContent = '‚úÖ Copiado!';
                btnCopiar.style.backgroundColor = 'var(--accent-success)';
                
                setTimeout(() => {
                    btnCopiar.textContent = textoOriginal;
                    btnCopiar.style.backgroundColor = '';
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar:', err);
                alert('Erro ao copiar para a √°rea de transfer√™ncia.');
            });
        }

        // ============================================
        // FUN√á√ïES DAS LISTAS DIN√ÇMICAS
        // ============================================

        /**
         * Adiciona uma premia√ß√£o √† lista
         */
        function adicionarPremiacao() {
            const input = document.getElementById('inputPremiacao');
            const valor = input.value.trim();
            
            if (!valor) {
                input.focus();
                return;
            }
            
            premiacoesList.push(valor);
            input.value = '';
            renderizarListas();
            atualizarProposta();
            input.focus();
        }

        /**
         * Adiciona uma cl√°usula √† lista
         */
        function adicionarClausula() {
            const input = document.getElementById('inputClausula');
            const valor = input.value.trim();
            
            if (!valor) {
                input.focus();
                return;
            }
            
            clausulasList.push(valor);
            input.value = '';
            renderizarListas();
            atualizarProposta();
            input.focus();
        }

        /**
         * Remove uma premia√ß√£o pelo √≠ndice
         */
        function removerPremiacao(index) {
            premiacoesList.splice(index, 1);
            renderizarListas();
            atualizarProposta();
        }

        /**
         * Remove uma cl√°usula pelo √≠ndice
         */
        function removerClausula(index) {
            clausulasList.splice(index, 1);
            renderizarListas();
            atualizarProposta();
        }

        /**
         * Trata pressionar Enter nos inputs de listas din√¢micas
         */
        function handleEnter(e, action) {
            if (e.key === 'Enter') {
                e.preventDefault();
                
                if (action === 'addPremiacao') {
                    adicionarPremiacao();
                } else if (action === 'addClausula') {
                    adicionarClausula();
                }
            }
        }

        /**
         * Renderiza as listas de premia√ß√µes e cl√°usulas no DOM
         */
        function renderizarListas() {
            // Renderizar premia√ß√µes
            const listaPremiacoes = document.getElementById('listaPremiacoes');
            listaPremiacoes.innerHTML = '';
            
            premiacoesList.forEach((premiacao, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <span>${premiacao}</span>
                    <button type="button" class="btn-remove-item" onclick="removerPremiacao(${index})" title="Remover">√ó</button>
                `;
                listaPremiacoes.appendChild(div);
            });

            // Renderizar cl√°usulas
            const listaClausulas = document.getElementById('listaClausulas');
            listaClausulas.innerHTML = '';
            
            clausulasList.forEach((clausula, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <span>${clausula}</span>
                    <button type="button" class="btn-remove-item" onclick="removerClausula(${index})" title="Remover">√ó</button>
                `;
                listaClausulas.appendChild(div);
            });
        }

        // ============================================
        // FIM - FUN√á√ïES DAS LISTAS DIN√ÇMICAS
        // ============================================

        
        document.getElementById('btnCopiar').addEventListener('click', copiarProposta);

        // Inicializar ao carregar
        window.addEventListener('load', () => {
            // Fun√ß√£o auxiliar de formata√ß√£o
            const formatMoneyDisplay = (valor) => {
                if (!valor || isNaN(valor)) return '';
                const numero = Math.floor(valor);
                return numero.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            };

            const formatMoneyInputProposta = (event) => {
                const input = event.target;
                let valor = input.value.replace(/\D/g, '');
                
                if (valor) {
                    valor = formatMoneyDisplay(parseInt(valor));
                }
                
                input.value = valor;
                
                // Atualizar badge
                const wrapper = input.parentElement;
                const badge = wrapper.querySelector('.magnitude-badge');
                if (badge) {
                    const numeroLimpo = parseMoney(valor);
                    badge.className = 'magnitude-badge';
                    
                    if (numeroLimpo >= 1000000) {
                        badge.textContent = 'M';
                        badge.classList.add('magnitude-M');
                    } else if (numeroLimpo >= 1000) {
                        badge.textContent = 'm';
                        badge.classList.add('magnitude-m');
                    } else {
                        badge.textContent = '';
                    }
                }
                
                atualizarProposta();
            };

            // Seleciona todos os inputs com classe 'input-money'
            const moneyInputs = document.querySelectorAll('.input-money');
            moneyInputs.forEach(input => {
                input.addEventListener('input', formatMoneyInputProposta);
                
                // Listener para validar limites ao sair do campo
                input.addEventListener('blur', (event) => {
                    const inp = event.target;
                    const min = Number(inp.dataset.min) || 0;
                    const max = Number(inp.dataset.max) || 999999999;
                    const valorAtual = parseMoney(inp.value);
                    
                    let valorCorrigido = valorAtual;
                    if (valorAtual < min) {
                        valorCorrigido = min;
                    } else if (valorAtual > max) {
                        valorCorrigido = max;
                    }
                    
                    if (valorCorrigido !== valorAtual) {
                        const valorFormatado = formatMoneyDisplay(valorCorrigido);
                        inp.value = valorFormatado;
                        
                        const badge = inp.parentElement.querySelector('.magnitude-badge');
                        if (badge) {
                            badge.className = 'magnitude-badge';
                            if (valorCorrigido >= 1000000) { 
                                badge.textContent = 'M'; 
                                badge.classList.add('magnitude-M'); 
                            }
                            else if (valorCorrigido >= 1000) { 
                                badge.textContent = 'm'; 
                                badge.classList.add('magnitude-m'); 
                            }
                            else { 
                                badge.textContent = ''; 
                            }
                        }
                        atualizarProposta();
                    }
                });
                
                // Formata valor padr√£o se existir
                if (input.value) {
                    const event = { target: input };
                    formatMoneyInputProposta(event);
                }
            });

            lerParametrosURL();
            
            // Formatar novamente ap√≥s carregar par√¢metros da URL
            moneyInputs.forEach(input => {
                if (input.value) {
                    const event = { target: input };
                    formatMoneyInputProposta(event);
                }
            });

            // Adicionar listeners para atualizar status e preview
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('input', () => {
                    atualizarProposta();
                });
                el.addEventListener('change', () => {
                    atualizarProposta();
                });
            });
            
            atualizarProposta();
        });
    </script>
</body>
</html>
